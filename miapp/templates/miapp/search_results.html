{% extends 'miapp/base_ventas.html' %}
{% load static %}

{% block title %}
    Search Results
{% endblock title %}

{% block content %}
<section class="content">
    <!-- Spinner Overlay -->
    <div id="loading-overlay" class="overlay" style="display: none;">
        <div class="overlay-content">
            <i class="fas fa-3x fa-sync-alt fa-spin"></i>
            <div class="text-bold pt-2">Loading...</div>
        </div>
    </div>


        <!-- Product Selection -->
        <div class="container mt-5">
            <h2 class="text-center mb-4">Select a Product</h2>
            <div class="row">
                {% if productos %}
                    {% for producto in productos %}
                    <div class="col-lg-3 col-md-4 col-sm-6 mb-4">
                        <div class="card shadow-sm border-light rounded product-card">
                            {% if producto.image1 %}
                            <img src="{{ producto.image1.url }}" class="card-img-top img-fluid" alt="{{ producto.nombre }}">
                            {% else %}
                            <img src="{% static 'default-image.png' %}" class="card-img-top img-fluid" alt="Default Image">
                            {% endif %}
                            <div class="card-body text-center">
                                <h5 class="card-title">{{ producto.nombre }}</h5>
                                <p class="card-text text-muted">Price: ${{ producto.precio }}</p>
                                <a href="#" class="btn btn-primary btn-sm select-product-btn" data-product-id="{{ producto.id }}">Select Product</a>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                {% else %}
                    <p class="text-center">No products found</p>
                {% endif %}
            </div>
        </div>
    </div>

    <!-- Selected Products Form -->
    <div class="container mt-5">
        <h2 class="text-center mb-4">Add Selected Products to Agency</h2>
        <form id="add-products-form" method="post" action="{% url 'home' %}">
            {% csrf_token %}
            <div class="form-group">
                <label for="agency-select">Select Agency</label>
                <select id="agency-select" class="form-control" name="agency">
                    {% for agencia in agencias %}
                    <option value="{{ agencia.id }}">{{ agencia.nombre }}</option>
                    {% endfor %}
                </select>
            </div>
            <input type="hidden" id="selected-products" name="selected_products" value="">
            <button type="submit" class="btn btn-primary">Add to Agency</button>
        </form>
    </div>
</section>

{% block extra_scripts %}
<style>
    /* Estilos para el Spinner Overlay */
    #loading-overlay {
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.5); /* Fondo semitransparente */
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 9999; /* Asegura que esté sobre otros elementos */
    }

    .overlay-content {
        text-align: center;
        color: #fff;
    }

    .overlay-content i {
        margin-bottom: 10px;
    }


    .card img {
        object-fit: cover;
        height: 200px; /* Altura fija para todas las imágenes */
    }

    .card-body {
        flex: 1; /* Asegura que el cuerpo de la tarjeta ocupe todo el espacio disponible */
    }



    /* Asegura que todas las tarjetas tengan el mismo tamaño */
    .product-card {
        height: 100%;
    }
</style>
<script>
    // Show the loading overlay when the page starts loading
    document.getElementById('loading-overlay').style.display = 'block';

    // Hide the loading overlay once the page has fully loaded
    window.onload = function() {
        document.getElementById('loading-overlay').style.display = 'none';
    };

    // Add functionality to handle product selection
    document.querySelectorAll('.select-product-btn').forEach(button => {
        button.addEventListener('click', function(event) {
            event.preventDefault();
            const productId = this.getAttribute('data-product-id');
            let selectedProducts = document.getElementById('selected-products').value.split(',');
            if (!selectedProducts.includes(productId)) {
                selectedProducts.push(productId);
                document.getElementById('selected-products').value = selectedProducts.join(',');
            }
        });
    });
</script>
{% endblock extra_scripts %}
{% endblock content %}
